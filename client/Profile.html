<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Nakatani ‚Äî –ü—Ä–æ—Ñ–∏–ª—å</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="images/Nakatani.png" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
      color: #353535;
    }

    .container {
      display: flex;
      max-width: 90%;
      margin: 100px auto;
      background-color: #fff;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      overflow: hidden;
      width: 80%;
      height: 80%;
    }

    .sidebar {
      width: 280px;
      background-color: #343a40;
      padding: 40px 25px;
      color: #fff;
    }

    .sidebar button {
      width: 100%;
      margin-bottom: 15px;
      padding: 12px;
      background-color: #495057;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .sidebar button:hover {
      background-color: #6d6d6d;
    }

    .content {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
      max-height: 80vh;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      color: rgb(0, 0, 0);
    }

    .readonly-field {
      padding: 10px;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    .error-msg {
      color: red;
      font-size: 14px;
      display: none;
      margin-top: 5px;
    }

    .save-msg {
      color: green;
      margin-top: 10px;
      font-weight: bold;
    }

    #save-btn {
      padding: 10px;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    #save-btn:hover {
      background-color: #afafaf;
    }

    .logout-btn {
      padding: 12px 20px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .logout-btn:hover {
      background-color: #c82333;
    }

    .order-item {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      transition: transform 0.2s ease;
      max-width: 100%;
      overflow-x: auto;
    }

    .order-item:hover {
      transform: translateY(-2px);
    }

    .order-item ul {
      list-style-type: disc;
      padding-left: 20px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        margin: 10px;
      }

      .sidebar {
        width: 100%;
        text-align: center;
        padding: 20px;
      }

      .content {
        padding: 20px;
      }

      .navbar-left, .navbar-right {
        display: none;
      }

      .navbar-center {
        margin: 0 auto;
      }
    }

    /* Footer */
    footer {
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 10px;
    }

    footer p {
      margin: 0;
      font-size: 0.9rem;
    }

    .footer-links {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1px;
    }

    .footer-item {
      width: 30%;
      padding: 10px;
    }

    .footer-item h3 {
      font-size: 10px;
      margin-bottom: 10px;
      color: #fff;
    }

    .footer-item p {
      font-size: 10px;
      color: #ddd;
      line-height: 1.5;
    }

    .footer-item p a {
      color: #ddd;
      text-decoration: none;
    }

    .footer-item p a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<!-- –®–∞–ø–∫–∞ —Å–∞–π—Ç–∞ -->
    <header>
        <nav>
            <ul class="navbar">
                <div class="navbar-left">
                    <li><a href="login_register.html" class="button">–í—Ö–æ–¥</a></li>
                    <li><a href="Profile.html" class="button">–ü—Ä–æ—Ñ–∏–ª—å</a></li>
                    <li><a href="index.html" class="button">–ì–ª–∞–≤–Ω–∞—è</a></li>
                </div>
                <div class="navbar-center">
                    <img src="images/nakatani.png" alt="–õ–æ–≥–æ—Ç–∏–ø Nakatani" class="navbar-logo">
                </div>
                <div class="navbar-right">
                    <li><a href="menu.html" class="button">–ú–µ–Ω—é</a></li>
                    <li><a href="Delivery terms.html" class="button">–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏</a></li>
                    <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –≤ —à–∞–ø–∫–µ -->
                     <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
                    <button id="cart-button" class="cart-button">
                        –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)
                    </button>
                
                    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
                    <div id="cartModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
                                <span class="close" id="closeCart">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div id="cartContent" class="cart-items">
                                    <div class="empty-cart">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
                                </div>
                                <div class="cart-total">
                                    –ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> ‚ÇΩ
                                </div>
                            </div>
                            <div class="modal-footer">
                                <a href="checkout.html" class="checkout-button">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</a>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </ul>
        </nav>
    </header>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
     <div id="cart-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div id="cart-items" class="cart-items">
                    <!-- –¢–æ–≤–∞—Ä –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                     <div class="empty-cart">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
                </div>
                <div class="modal-footer">
                    <button id="checkout-button" class="checkout-button">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                </div>
            </div>
        </div>
     </div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
<div class="container">
  <div class="sidebar">
    <button onclick="showSection('account')">–£—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å</button>
    <button onclick="showSection('orders')">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</button>
    <button class="logout-btn" id="logout-btn">–í—ã–π—Ç–∏</button>
  </div>

  <div class="content">
    <div id="account" class="section active">
      <h2>–£—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å</h2>

      <div class="form-group">
        <label><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong></label>
        <p id="profile-username" class="readonly-field"></p>
      </div>

      <div class="form-group">
        <label for="profile-email"><strong>Email:</strong></label>
        <input type="email" id="profile-email" placeholder="–í–∞—à email" />
        <span id="email-error" class="error-msg">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</span>
      </div>

      <div class="form-group">
        <label for="profile-bio"><strong>–û —Å–µ–±–µ:</strong></label>
        <textarea id="profile-bio" rows="4" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..."></textarea>
      </div>

      <div class="form-group">
        <label><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong></label>
        <p id="profile-reg-date" class="readonly-field"></p>
      </div>

      <button id="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
      <p id="save-status" class="save-msg"></p>
    </div>

    <div id="orders" class="section">
      <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
      <div id="orderHistory"></div>
    </div>
  </div>
</div>

<footer>
  <p>&copy; 2025 Nakatani. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const username = localStorage.getItem('loggedInUser');
    if (!username) return window.location.href = 'login_register.html';

    let userData = JSON.parse(localStorage.getItem(`user_${username}`));
    if (!userData) return window.location.href = 'login_register.html';

    if (!userData.regDate) {
      userData.regDate = new Date().toLocaleDateString();
      localStorage.setItem(`user_${username}`, JSON.stringify(userData));
    }
    document.getElementById('profile-username').textContent = username;
    document.getElementById('profile-email').value = userData.email || '';
    document.getElementById('profile-bio').value = userData.bio || '';
    document.getElementById('profile-reg-date').textContent = userData.regDate;

    document.getElementById('save-btn').addEventListener('click', function () {
      const email = document.getElementById('profile-email').value;
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        document.getElementById('email-error').style.display = 'inline';
        return;
      }
      document.getElementById('email-error').style.display = 'none';
      userData.email = email;
      userData.bio = document.getElementById('profile-bio').value;
      localStorage.setItem(`user_${username}`, JSON.stringify(userData));
      document.getElementById('save-status').textContent = "–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!";
      setTimeout(() => document.getElementById('save-status').textContent = '', 3000);
    });

    document.getElementById('logout-btn').addEventListener('click', function () {
      localStorage.removeItem('loggedInUser');
      window.location.href = 'login_register.html';
    });
  });
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if (id === 'orders') {
      const username = localStorage.getItem('loggedInUser');
      if (username) loadOrderHistory(username);
    }
  }

  function loadOrderHistory(username) {
    const legacyOrders = JSON.parse(localStorage.getItem(`orders_${username}`)) || [];
    const newOrders = JSON.parse(localStorage.getItem('orderHistory')) || [];
    const container = document.getElementById("orderHistory");

    if (legacyOrders.length === 0 && newOrders.length === 0) {
      container.innerHTML = "<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</p>";
      return;
    }

    let html = '';

    legacyOrders.forEach((order, index) => {
      html += `
        <div class="order-item">
          <p><strong>üì¶ –ó–∞–∫–∞–∑ ‚Ññ${index + 1}</strong></p>
          <p><strong>üìÖ –î–∞—Ç–∞:</strong> ${order.date}</p>
          <p><strong>üßæ –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</strong></p>
          <ul>${order.items.map(item => `<li>${item.name} √ó ${item.quantity} ‚Äî ${item.price * item.quantity} ‚ÇΩ</li>`).join('')}</ul>
          <p><strong>üí∞ –°—É–º–º–∞:</strong> ${order.total} ‚ÇΩ</p>
        </div>`;
    });

    newOrders.forEach((order, index) => {
      html += `
        <div class="order-item">
          <p><strong>üì¶ –ó–∞–∫–∞–∑ ‚Ññ${index + 1}</strong></p>
          <p><strong>üìÖ –î–∞—Ç–∞:</strong> ${order.date}</p>
          <p><strong>üìç –ê–¥—Ä–µ—Å:</strong> ${order.address}</p>
          <p><strong>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${order.phone}</p>
          <p><strong>üí≥ –û–ø–ª–∞—Ç–∞:</strong> ${order.paymentMethod === 'cash' ? '–ù–∞–ª–∏—á–Ω—ã–º–∏' : '–ö–∞—Ä—Ç–æ–π –∫—É—Ä—å–µ—Ä—É'}</p>
          <p><strong>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> ${order.comments || '‚Äî'}</p>
          <p><strong>üßæ –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</strong></p>
          <ul>${order.items.map(item => `<li>${item.name} ‚Äî ${item.price} ‚ÇΩ √ó ${item.quantity}</li>`).join('')}</ul>
          <p><strong>üí∞ –°—É–º–º–∞:</strong> ${order.total} ‚ÇΩ</p>
        </div>`;
    });

    container.innerHTML = html;
  }
</script>

</body>
</html>
